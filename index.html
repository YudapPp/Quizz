<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduQuiz - Platform Quiz Interaktif</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --danger: #ef233c;
            --warning: #ff9e00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: none;
        }

        .card.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .card-body {
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
        }

        .btn {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-accent {
            background: linear-gradient(to right, var(--accent), #b5179e);
        }

        .btn-danger {
            background: linear-gradient(to right, var(--danger), #d00000);
        }

        .btn-warning {
            background: linear-gradient(to right, var(--warning), #ff9100);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .avatar-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .avatar-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            object-fit: cover;
        }

        .avatar-option:hover, .avatar-option.selected {
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .room-code {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 3px;
            text-align: center;
            margin: 20px 0;
            color: var(--primary);
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            display: inline-block;
            width: auto;
            margin-left: auto;
            margin-right: auto;
        }

        .participants {
            margin-top: 30px;
        }

        .participant {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }

        .participant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .quiz-container {
            text-align: center;
        }

        .question {
            font-size: 22px;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            background: #e9ecef;
        }

        .option.selected {
            background: var(--primary);
            color: white;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hidden {
            display: none;
        }

        .error-message {
            color: var(--danger);
            margin-top: 5px;
            font-size: 14px;
        }

        .success-message {
            color: var(--success);
            margin-top: 5px;
            font-size: 14px;
        }

        .question-form {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            position: relative;
        }

        .add-question-btn {
            margin-top: 10px;
        }

        .remove-question-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .quiz-status {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }

        .status-active {
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-waiting {
            background-color: rgba(255, 158, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        @media (max-width: 768px) {
            .options {
                grid-template-columns: 1fr;
            }
            
            .card-body {
                padding: 20px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <!-- Card 1: Pilih Peran -->
        <div class="card active" id="roleCard">
            <div class="card-header">
                <h1>Selamat Datang di EduQuiz!</h1>
            </div>
            <div class="card-body">
                <h2 style="text-align: center; margin-bottom: 30px;">Pilih Peran Anda</h2>
                <button class="btn btn-block" onclick="showCard('hostCard')">Buat Room Baru (Host)</button>
                <div style="text-align: center; margin: 20px 0; color: #6c757d;">ATAU</div>
                <button class="btn btn-block" onclick="showCard('joinCard')">Gabung Room (Peserta)</button>
            </div>
        </div>

        <!-- Card 2: Buat Room -->
        <div class="card" id="hostCard">
            <div class="card-header">
                <button class="back-btn" onclick="showCard('roleCard')">
                    <span class="material-symbols-outlined">arrow_back</span> Kembali
                </button>
                <h1>Buat Room Quiz Baru</h1>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="hostName">Nama Anda</label>
                    <input type="text" id="hostName" placeholder="Masukkan nama Anda">
                    <div class="error-message" id="hostNameError"></div>
                </div>
                <div class="form-group">
                    <label>Pilih Avatar</label>
                    <div class="avatar-options">
                        <img src="https://i.pravatar.cc/150?img=1" class="avatar-option" onclick="selectAvatar(this, 'host')">
                        <img src="https://i.pravatar.cc/150?img=2" class="avatar-option" onclick="selectAvatar(this, 'host')">
                        <img src="https://i.pravatar.cc/150?img=3" class="avatar-option" onclick="selectAvatar(this, 'host')">
                        <img src="https://i.pravatar.cc/150?img=4" class="avatar-option" onclick="selectAvatar(this, 'host')">
                        <img src="https://i.pravatar.cc/150?img=5" class="avatar-option" onclick="selectAvatar(this, 'host')">
                    </div>
                    <div class="error-message" id="hostAvatarError"></div>
                </div>
                <div class="form-group">
                    <label for="roomTopic">Topik Quiz</label>
                    <input type="text" id="roomTopic" placeholder="Contoh: Matematika Dasar">
                </div>
                <button class="btn btn-block" onclick="createRoom()">Buat Room</button>
            </div>
        </div>

        <!-- Card 3: Gabung Room -->
        <div class="card" id="joinCard">
            <div class="card-header">
                <button class="back-btn" onclick="showCard('roleCard')">
                    <span class="material-symbols-outlined">arrow_back</span> Kembali
                </button>
                <h1>Gabung Room Quiz</h1>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="roomCode">Kode Room</label>
                    <input type="text" id="roomCode" placeholder="Masukkan 6 digit kode room" maxlength="6" style="text-transform: uppercase;">
                    <div class="error-message" id="roomCodeError"></div>
                </div>
                <div class="form-group">
                    <label for="participantName">Nama Anda</label>
                    <input type="text" id="participantName" placeholder="Masukkan nama Anda">
                    <div class="error-message" id="participantNameError"></div>
                </div>
                <div class="form-group">
                    <label>Pilih Avatar</label>
                    <div class="avatar-options">
                        <img src="https://i.pravatar.cc/150?img=6" class="avatar-option" onclick="selectAvatar(this, 'participant')">
                        <img src="https://i.pravatar.cc/150?img=7" class="avatar-option" onclick="selectAvatar(this, 'participant')">
                        <img src="https://i.pravatar.cc/150?img=8" class="avatar-option" onclick="selectAvatar(this, 'participant')">
                        <img src="https://i.pravatar.cc/150?img=9" class="avatar-option" onclick="selectAvatar(this, 'participant')">
                        <img src="https://i.pravatar.cc/150?img=10" class="avatar-option" onclick="selectAvatar(this, 'participant')">
                    </div>
                    <div class="error-message" id="participantAvatarError"></div>
                </div>
                <button class="btn btn-block" onclick="joinRoom()">Gabung Room</button>
            </div>
        </div>

        <!-- Card 4: Lobby Room (Host) -->
        <div class="card" id="hostLobbyCard">
            <div class="card-header">
                <button class="back-btn" onclick="exitRoom()">
                    <span class="material-symbols-outlined">arrow_back</span> Keluar
                </button>
                <h1>Room Anda</h1>
            </div>
            <div class="card-body">
                <div class="room-code" id="hostRoomCodeDisplay">KODE</div>
                <p style="text-align: center;" id="hostRoomTopicDisplay">Topik: <span id="roomTopicText"></span></p>
                <p style="text-align: center;">Bagikan kode ini ke peserta</p>
                
                <div class="quiz-status" id="quizStatusHost">
                    Status: <span id="quizStatusTextHost">Menunggu peserta</span>
                </div>
                
                <div class="participants" id="participantsList">
                    <!-- Daftar peserta akan muncul di sini -->
                </div>
                
                <div id="questionSetupSection">
                    <h3 style="margin: 20px 0 10px;">Buat Pertanyaan</h3>
                    <div id="questionFormsContainer">
                        <!-- Form pertanyaan akan muncul di sini -->
                    </div>
                    <button class="btn add-question-btn" onclick="addQuestionForm()">
                        <span class="material-symbols-outlined">add</span> Tambah Pertanyaan
                    </button>
                </div>
                
                <button class="btn btn-accent btn-block" id="startQuizBtn" onclick="startQuiz()">Mulai Quiz</button>
                <button class="btn btn-danger btn-block" id="endQuizBtn" onclick="endQuiz()" style="margin-top: 10px; display: none;">Akhiri Quiz</button>
            </div>
        </div>

        <!-- Card 5: Lobby Room (Peserta) -->
        <div class="card" id="participantLobbyCard">
            <div class="card-header">
                <button class="back-btn" onclick="exitRoom()">
                    <span class="material-symbols-outlined">arrow_back</span> Keluar
                </button>
                <h1 id="participantLobbyTitle">Menunggu Host Memulai Quiz</h1>
            </div>
            <div class="card-body">
                <div class="room-code" id="participantRoomCodeDisplay">KODE</div>
                <p style="text-align: center;">Topik: <span id="participantRoomTopic"></span></p>
                
                <div class="quiz-status" id="quizStatusParticipant">
                    Status: <span id="quizStatusTextParticipant">Menunggu host memulai</span>
                </div>
                
                <div class="participants" id="participantViewList">
                    <!-- Daftar peserta akan muncul di sini -->
                </div>
                
                <div id="waitingMessage">
                    <p style="text-align: center; margin-top: 20px;" id="waitingText">Menunggu host memulai quiz...</p>
                </div>
            </div>
        </div>

        <!-- Card 6: Quiz Screen -->
        <div class="card" id="quizCard">
            <div class="card-header">
                <button class="back-btn" onclick="backToLobby()">
                    <span class="material-symbols-outlined">arrow_back</span> Kembali
                </button>
                <h1 id="quizTitle">EduQuiz</h1>
            </div>
            <div class="card-body">
                <div class="quiz-container">
                    <div class="question" id="questionText">Pertanyaan akan muncul di sini</div>
                    <div class="options" id="optionsContainer">
                        <!-- Opsi jawaban akan muncul di sini -->
                    </div>
                    <div class="quiz-controls">
                        <button class="btn" id="prevQuestionBtn" onclick="prevQuestion()">
                            <span class="material-symbols-outlined">arrow_back</span> Sebelumnya
                        </button>
                        <span id="questionCounter">1/10</span>
                        <button class="btn" id="nextQuestionBtn" onclick="nextQuestion()">
                            Selanjutnya <span class="material-symbols-outlined">arrow_forward</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data aplikasi
        const appData = {
            role: null, // 'host' atau 'participant'
            roomCode: null,
            user: {
                name: '',
                avatar: ''
            },
            roomTopic: '',
            participants: [],
            rooms: {}, // Untuk menyimpan data room yang aktif
            currentRoom: null,
            quiz: {
                currentQuestion: 0,
                questions: [],
                isActive: false
            }
        };

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            
            // Load saved questions if any
            const savedQuestions = localStorage.getItem('quizQuestions');
            if (savedQuestions) {
                try {
                    const questions = JSON.parse(savedQuestions);
                    if (Array.isArray(questions) {
                        // Only load if we're in host lobby
                        if (document.getElementById('hostLobbyCard').classList.contains('active')) {
                            setTimeout(() => {
                                setupQuestionForms(questions);
                                showSuccessMessage('Pertanyaan yang belum tersimpan telah dimuat otomatis');
                            }, 500);
                        }
                    }
                } catch (e) {
                    console.error('Error parsing saved questions:', e);
                }
            }
            
            // Auto-save questions every 5 seconds
            setInterval(saveQuestionsToLocalStorage, 5000);
        });

        // Simpan pertanyaan ke localStorage
        function saveQuestionsToLocalStorage() {
            if (appData.role === 'host' && document.getElementById('questionFormsContainer')) {
                const questions = getQuestionsFromForms();
                localStorage.setItem('quizQuestions', JSON.stringify(questions));
            }
        }

        // Clear saved questions
        function clearSavedQuestions() {
            localStorage.removeItem('quizQuestions');
        }

        // Cek status login dari localStorage
        function checkLoginStatus() {
            const savedData = localStorage.getItem('eduQuizData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                if (data.role === 'host' && data.roomCode && appData.rooms[data.roomCode]) {
                    joinAsHost(data.roomCode, data.user);
                } else if (data.role === 'participant' && data.roomCode && appData.rooms[data.roomCode]) {
                    joinAsParticipant(data.roomCode, data.user);
                } else {
                    showCard('roleCard');
                }
            } else {
                showCard('roleCard');
            }
        }

        // Tampilkan card tertentu
        function showCard(cardId) {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(cardId).classList.add('active');
            
            // Scroll ke atas
            window.scrollTo(0, 0);
        }

        // Tampilkan pesan sukses
        function showSuccessMessage(message) {
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.textContent = message;
            document.getElementById('questionSetupSection').prepend(successMsg);
            
            // Hilangkan setelah 3 detik
            setTimeout(() => {
                successMsg.remove();
            }, 3000);
        }

        // Pilih avatar
        function selectAvatar(element, role) {
            // Hapus seleksi sebelumnya
            document.querySelectorAll(`.avatar-option[data-role="${role}"]`).forEach(avatar => {
                avatar.classList.remove('selected');
            });
            
            // Tambahkan seleksi baru
            element.classList.add('selected');
            element.setAttribute('data-role', role);
        }

        // Buat room baru
        function createRoom() {
            // Validasi input
            const name = document.getElementById('hostName').value.trim();
            const avatarElement = document.querySelector('.avatar-option.selected[data-role="host"]');
            const topic = document.getElementById('roomTopic').value.trim() || 'Quiz Edukasi';
            
            // Reset error messages
            document.getElementById('hostNameError').textContent = '';
            document.getElementById('hostAvatarError').textContent = '';
            
            let isValid = true;
            
            if (!name) {
                document.getElementById('hostNameError').textContent = 'Nama harus diisi';
                isValid = false;
            }
            
            if (!avatarElement) {
                document.getElementById('hostAvatarError').textContent = 'Pilih avatar terlebih dahulu';
                isValid = false;
            }
            
            if (!isValid) return;
            
            const avatar = avatarElement.src;
            
            // Generate kode room acak
            const roomCode = generateRoomCode();
            
            // Buat room baru
            appData.rooms[roomCode] = {
                code: roomCode,
                host: { name, avatar },
                topic: topic,
                participants: [],
                questions: [],
                isActive: false
            };
            
            // Gabung sebagai host
            joinAsHost(roomCode, { name, avatar });
        }

        // Gabung sebagai host
        function joinAsHost(roomCode, user) {
            const room = appData.rooms[roomCode];
            if (!room) {
                alert('Room tidak ditemukan');
                showCard('roleCard');
                return;
            }
            
            // Simpan data
            appData.role = 'host';
            appData.roomCode = roomCode;
            appData.user = user;
            appData.currentRoom = room;
            
            // Tambahkan host ke peserta
            if (!room.participants.some(p => p.name === user.name)) {
                room.participants.push(user);
            }
            
            // Simpan ke localStorage
            localStorage.setItem('eduQuizData', JSON.stringify({
                role: 'host',
                roomCode,
                user
            }));
            
            // Tampilkan lobby host
            showCard('hostLobbyCard');
            updateRoomDisplay();
            
            // Setup form pertanyaan
            setupQuestionForms(room.questions);
            
            // Update status quiz
            updateQuizStatus();
        }

        // Gabung room
        function joinRoom() {
            // Validasi input
            const roomCode = document.getElementById('roomCode').value.trim().toUpperCase();
            const name = document.getElementById('participantName').value.trim();
            const avatarElement = document.querySelector('.avatar-option.selected[data-role="participant"]');
            
            // Reset error messages
            document.getElementById('roomCodeError').textContent = '';
            document.getElementById('participantNameError').textContent = '';
            document.getElementById('participantAvatarError').textContent = '';
            
            let isValid = true;
            
            if (!roomCode || roomCode.length !== 6) {
                document.getElementById('roomCodeError').textContent = 'Kode room harus 6 karakter';
                isValid = false;
            } else if (!appData.rooms[roomCode]) {
                document.getElementById('roomCodeError').textContent = 'Room tidak ditemukan';
                isValid = false;
            } else if (appData.rooms[roomCode].isActive) {
                document.getElementById('roomCodeError').textContent = 'Quiz sudah dimulai, tidak bisa bergabung sekarang';
                isValid = false;
            }
            
            if (!name) {
                document.getElementById('participantNameError').textContent = 'Nama harus diisi';
                isValid = false;
            }
            
            if (!avatarElement) {
                document.getElementById('participantAvatarError').textContent = 'Pilih avatar terlebih dahulu';
                isValid = false;
            }
            
            if (!isValid) return;
            
            const avatar = avatarElement.src;
            const room = appData.rooms[roomCode];
            
            // Gabung sebagai peserta
            joinAsParticipant(roomCode, { name, avatar });
        }

        // Gabung sebagai peserta
        function joinAsParticipant(roomCode, user) {
            const room = appData.rooms[roomCode];
            if (!room) {
                alert('Room tidak ditemukan');
                showCard('roleCard');
                return;
            }
            
            // Cek apakah quiz sudah dimulai
            if (room.isActive) {
                alert('Quiz sudah dimulai, tidak bisa bergabung sekarang');
                showCard('roleCard');
                return;
            }
            
            // Simpan data
            appData.role = 'participant';
            appData.roomCode = roomCode;
            appData.user = user;
            appData.currentRoom = room;
            
            // Tambahkan peserta ke room (jika belum ada)
            if (!room.participants.some(p => p.name === user.name)) {
                room.participants.push(user);
            }
            
            // Simpan ke localStorage
            localStorage.setItem('eduQuizData', JSON.stringify({
                role: 'participant',
                roomCode,
                user
            }));
            
            // Tampilkan lobby peserta
            showCard('participantLobbyCard');
            updateRoomDisplay();
            updateQuizStatus();
        }

        // Keluar dari room
        function exitRoom() {
            if (confirm('Apakah Anda yakin ingin keluar dari room?')) {
                if (appData.role === 'host') {
                    // Host keluar, hapus room
                    if (appData.roomCode && appData.rooms[appData.roomCode]) {
                        delete appData.rooms[appData.roomCode];
                    }
                } else if (appData.role === 'participant') {
                    // Peserta keluar, hapus dari daftar peserta
                    if (appData.roomCode && appData.rooms[appData.roomCode]) {
                        const room = appData.rooms[appData.roomCode];
                        room.participants = room.participants.filter(p => p.name !== appData.user.name);
                    }
                }
                
                // Hapus data dari localStorage
                localStorage.removeItem('eduQuizData');
                clearSavedQuestions();
                
                // Kembali ke menu utama
                showCard('roleCard');
            }
        }

        // Kembali ke lobby dari quiz
        function backToLobby() {
            if (appData.role === 'host') {
                showCard('hostLobbyCard');
            } else {
                showCard('participantLobbyCard');
            }
        }

        // Update tampilan room
        function updateRoomDisplay() {
            const room = appData.currentRoom;
            if (!room) return;
            
            // Update kode room
            document.getElementById('hostRoomCodeDisplay').textContent = room.code;
            document.getElementById('participantRoomCodeDisplay').textContent = room.code;
            
            // Update topik room
            document.getElementById('roomTopicText').textContent = room.topic;
            document.getElementById('participantRoomTopic').textContent = room.topic;
            
            // Update daftar peserta
            updateParticipantsList();
        }

        // Update status quiz
        function updateQuizStatus() {
            const room = appData.currentRoom;
            if (!room) return;
            
            if (room.isActive) {
                // Quiz aktif
                document.getElementById('quizStatusHost').className = 'quiz-status status-active';
                document.getElementById('quizStatusTextHost').textContent = 'Quiz sedang berlangsung';
                document.getElementById('startQuizBtn').style.display = 'none';
                document.getElementById('endQuizBtn').style.display = 'block';
                
                document.getElementById('quizStatusParticipant').className = 'quiz-status status-active';
                document.getElementById('quizStatusTextParticipant').textContent = 'Quiz sedang berlangsung';
                document.getElementById('participantLobbyTitle').textContent = 'Quiz Sedang Berlangsung';
                document.getElementById('waitingText').textContent = 'Quiz sedang berlangsung...';
            } else {
                // Menunggu
                document.getElementById('quizStatusHost').className = 'quiz-status status-waiting';
                document.getElementById('quizStatusTextHost').textContent = 'Menunggu peserta';
                document.getElementById('startQuizBtn').style.display = 'block';
                document.getElementById('endQuizBtn').style.display = 'none';
                
                document.getElementById('quizStatusParticipant').className = 'quiz-status status-waiting';
                document.getElementById('quizStatusTextParticipant').textContent = 'Menunggu host memulai';
                document.getElementById('participantLobbyTitle').textContent = 'Menunggu Host Memulai Quiz';
                document.getElementById('waitingText').textContent = 'Menunggu host memulai quiz...';
            }
        }

        // Update daftar peserta
        function updateParticipantsList() {
            const room = appData.currentRoom;
            if (!room) return;
            
            const hostList = document.getElementById('participantsList');
            const participantList = document.getElementById('participantViewList');
            
            if (hostList) {
                hostList.innerHTML = '<h3 style="margin-bottom: 15px;">Peserta (' + room.participants.length + ')</h3>';
                room.participants.forEach(participant => {
                    const participantElement = document.createElement('div');
                    participantElement.className = 'participant';
                    participantElement.innerHTML = `
                        <img src="${participant.avatar}" class="participant-avatar">
                        <span>${participant.name} ${participant.name === room.host.name ? '(Host)' : ''}</span>
                    `;
                    hostList.appendChild(participantElement);
                });
            }
            
            if (participantList) {
                participantList.innerHTML = '<h3 style="margin-bottom: 15px;">Peserta (' + room.participants.length + ')</h3>';
                room.participants.forEach(participant => {
                    const participantElement = document.createElement('div');
                    participantElement.className = 'participant';
                    participantElement.innerHTML = `
                        <img src="${participant.avatar}" class="participant-avatar">
                        <span>${participant.name} ${participant.name === room.host.name ? '(Host)' : ''}</span>
                    `;
                    participantList.appendChild(participantElement);
                });
            }
        }

        // Setup form pertanyaan untuk host
        function setupQuestionForms(questions = []) {
            const container = document.getElementById('questionFormsContainer');
            container.innerHTML = '';
            
            if (questions.length === 0) {
                addQuestionForm();
            } else {
                questions.forEach((q, index) => {
                    addQuestionForm(q, index);
                });
            }
        }

        // Dapatkan pertanyaan dari form
        function getQuestionsFromForms() {
            const questionForms = document.querySelectorAll('.question-form');
            const questions = [];
            
            questionForms.forEach(form => {
                const questionText = form.querySelector('.question-input').value.trim();
                const options = Array.from(form.querySelectorAll('.option-input')).map(input => input.value.trim()).filter(opt => opt);
                
                if (questionText && options.length >= 2) {
                    questions.push({
                        question: questionText,
                        options: options,
                        answer: 0 // Default jawaban benar adalah opsi pertama
                    });
                }
            });
            
            return questions;
        }

        // Tambah form pertanyaan baru
        function addQuestionForm(questionData = null, index = null) {
            const container = document.getElementById('questionFormsContainer');
            const questionId = index !== null ? index : Date.now();
            
            const questionForm = document.createElement('div');
            questionForm.className = 'question-form';
            questionForm.dataset.id = questionId;
            
            questionForm.innerHTML = `
                <button class="remove-question-btn" onclick="removeQuestionForm(${questionId})">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="form-group">
                    <label>Pertanyaan ${index !== null ? index + 1 : container.children.length + 1}</label>
                    <textarea placeholder="Masukkan pertanyaan" class="question-input">${questionData ? questionData.question : ''}</textarea>
                </div>
                <div class="form-group">
                    <label>Opsi Jawaban</label>
                    <input type="text" placeholder="Opsi 1 (Jawaban Benar)" class="option-input" value="${questionData ? questionData.options[0] : ''}">
                    <input type="text" placeholder="Opsi 2" class="option-input" value="${questionData ? questionData.options[1] : ''}">
                    <input type="text" placeholder="Opsi 3" class="option-input" value="${questionData ? questionData.options[2] : ''}">
                    <input type="text" placeholder="Opsi 4" class="option-input" value="${questionData ? questionData.options[3] : ''}">
                </div>
            `;
            
            container.appendChild(questionForm);
        }

        // Hapus form pertanyaan
        function removeQuestionForm(questionId) {
            if (confirm('Apakah Anda yakin ingin menghapus pertanyaan ini?')) {
                const form = document.querySelector(`.question-form[data-id="${questionId}"]`);
                if (form) {
                    form.remove();
                    
                    // Update nomor pertanyaan
                    const forms = document.querySelectorAll('.question-form');
                    forms.forEach((form, index) => {
                        const label = form.querySelector('label');
                        if (label) {
                            label.textContent = `Pertanyaan ${index + 1}`;
                        }
                    });
                }
            }
        }

        // Mulai quiz (hanya host)
        function startQuiz() {
            if (appData.role !== 'host') return;
            
            // Simpan semua pertanyaan ke room
            const questions = getQuestionsFromForms();
            
            if (questions.length === 0) {
                alert('Tambahkan setidaknya satu pertanyaan sebelum memulai quiz!');
                return;
            }
            
            appData.currentRoom.questions = questions;
            appData.currentRoom.isActive = true;
            
            // Mulai quiz
            appData.quiz.questions = questions;
            appData.quiz.currentQuestion = 0;
            appData.quiz.isActive = true;
            
            // Simpan pertanyaan ke localStorage
            clearSavedQuestions();
            
            // Update status
            updateQuizStatus();
            
            // Tampilkan layar quiz
            showCard('quizCard');
            document.getElementById('quizTitle').textContent = appData.currentRoom.topic;
            loadQuestion(0);
        }

        // Akhiri quiz (hanya host)
        function endQuiz() {
            if (appData.role !== 'host') return;
            
            if (confirm('Apakah Anda yakin ingin mengakhiri quiz?')) {
                appData.currentRoom.isActive = false;
                appData.quiz.isActive = false;
                
                // Kembali ke lobby
                showCard('hostLobbyCard');
                updateQuizStatus();
            }
        }

        // Tampilkan pertanyaan
        function loadQuestion(index) {
            if (index < 0 || index >= appData.quiz.questions.length) return;
            
            appData.quiz.currentQuestion = index;
            const question = appData.quiz.questions[index];
            
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionCounter').textContent = `${index + 1}/${appData.quiz.questions.length}`;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.onclick = function() {
                    selectOption(i);
                };
                optionsContainer.appendChild(optionElement);
            });
            
            // Update tombol navigasi
            document.getElementById('prevQuestionBtn').classList.toggle('hidden', index === 0);
            document.getElementById('nextQuestionBtn').classList.toggle('hidden', index === appData.quiz.questions.length - 1);
        }

        // Pilih opsi jawaban
        function selectOption(index) {
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            
            // Set jawaban benar (hanya untuk host)
            if (appData.role === 'host') {
                appData.quiz.questions[appData.quiz.currentQuestion].answer = index;
            }
        }

        // Pertanyaan sebelumnya
        function prevQuestion() {
            loadQuestion(appData.quiz.currentQuestion - 1);
        }

        // Pertanyaan berikutnya
        function nextQuestion() {
            loadQuestion(appData.quiz.currentQuestion + 1);
        }

        // Generate kode room acak
        function generateRoomCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Tidak termasuk I,1,O,0 untuk menghindari kebingungan
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
    </script>
</body>
</html>
